<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biology Units and Sub Units</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom font for better Sinhala rendering and modern look */
    body {
      font-family: "Inter", "Segoe UI", "Iskoola Pota", sans-serif;
    }
    /* No custom styles for plus/minus icon as it's removed */

    /* Subtopics within the unit are now always hidden as they are shown in a modal */
    .subtopics {
      display: none; /* Hide the original subtopics */
    }

    /* Modal overlay animation styles (fade in/out) */
    #subtopicModal {
      transition: opacity 0.3s ease-out; /* For the background overlay fade */
      opacity: 0; /* Start hidden */
      /* backdrop-filter: blur(5px); Removed blur effect */
    }
    #subtopicModal.is-active {
      opacity: 1; /* Fade in */
    }

    /* Keyframe animations for the modal content */
    @keyframes modal-pop-in {
      0% {
        opacity: 0;
        transform: scale(0.8);
      }
      75% {
        opacity: 1;
        transform: scale(1.05); /* Slight overshoot for a "pop" effect */
      }
      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes modal-pop-out {
      0% {
        opacity: 1;
        transform: scale(1);
      }
      100% {
        opacity: 0;
        transform: scale(0.8);
      }
    }

    /* Modal content animation styles */
    #subtopicModal > div {
      /* Initial state for animation */
      opacity: 0;
      transform: scale(0.8); /* Start smaller */
      transition: none; /* Remove default transition to use keyframes */
    }

    #subtopicModal.is-active > div {
      /* Apply pop-in animation when active */
      animation: modal-pop-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; /* Custom cubic-bezier for bounce */
    }

    #subtopicModal.is-closing > div {
      /* Apply pop-out animation when closing */
      animation: modal-pop-out 0.3s ease-in forwards;
    }

    /* Styles for the custom tick circle */
    .tick-circle {
      width: 1.5rem; /* 24px */
      height: 1.5rem; /* 24px */
      border-radius: 50%;
      border: 2px solid #cbd5e0; /* Gray border */
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
      flex-shrink: 0; /* Prevent it from shrinking */
    }

    .tick-circle.checked {
      background-color: #3b82f6; /* Blue background */
      border-color: #3b82f6; /* Blue border */
      color: #ffffff; /* White tick */
    }

    /* Reminder message styles - POSITIONED RELATIVE TO MODAL CONTENT */
    #reminderMessage {
      position: absolute; /* Relative to its parent, which is the modal content div */
      top: calc(100% + 15px); /* Position below the modal content with some spacing */
      left: 50%;
      transform: translateX(-50%);
      background-color: #ef4444; /* Red-500 */
      color: white;
      padding: 0.75rem 1.5rem; /* Responsive padding using rem */
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1001; /* Higher than modal content to ensure visibility */
      opacity: 0;
      transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; /* Add visibility transition */
      visibility: hidden; /* Initially hidden, but not display: none */
      pointer-events: none; /* Not clickable when hidden */
      font-size: 0.875rem; /* Base font size for responsiveness (text-sm in Tailwind) */
      text-align: center; /* Center text */
      max-width: 90%; /* Allow it to take up to 90% of parent width */
      box-sizing: border-box; /* Include padding in width calculation */
    }

    /* Media query for larger screens to increase font size and max-width */
    @media (min-width: 768px) { /* md breakpoint in Tailwind */
      #reminderMessage {
        font-size: 1rem; /* text-base in Tailwind */
        max-width: 300px; /* Max width for larger screens */
      }
    }

    #reminderMessage.show {
      opacity: 1;
      visibility: visible;
      pointer-events: auto; /* Clickable when shown */
    }
  </style>
</head>
<body class="bg-gray-100 p-8 max-w-4xl mx-auto text-gray-800 rounded-lg shadow-lg">

<div id="auth-section" class="flex flex-col items-center justify-center min-h-screen">
    <div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-md">
        <h2 class="text-center text-3xl font-extrabold mb-6 text-blue-800">Sign In / Sign Up</h2>
        <div id="auth-error" class="text-red-500 text-center mb-4 hidden"></div>

        <div class="mb-4">
            <input type="email" id="email-input" placeholder="Email" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
        </div>
        <div class="mb-6">
            <input type="password" id="password-input" placeholder="Password" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
        </div>

        <button id="signin-email-btn" class="w-full bg-blue-600 text-white p-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors duration-200 mb-3">Sign In with Email</button>
        <button id="signup-email-btn" class="w-full bg-green-600 text-white p-3 rounded-lg font-semibold hover:bg-green-700 transition-colors duration-200 mb-6">Sign Up with Email</button>

        <div class="relative flex items-center justify-center mb-6">
            <div class="absolute inset-0 flex items-center">
                <span class="w-full border-t border-gray-300"></span>
            </div>
            <div class="relative bg-white px-4 text-sm text-gray-500">Or</div>
        </div>

        <button id="signin-google-btn" class="w-full bg-red-600 text-white p-3 rounded-lg font-semibold hover:bg-red-700 transition-colors duration-200 flex items-center justify-center space-x-2">
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12.0003 4.75C14.0503 4.75 15.8303 5.44 17.2403 6.72L19.9903 3.97C18.1903 2.31 15.8003 1.25 12.0003 1.25C7.79031 1.25 4.10031 3.75 2.37031 7.52L5.61031 9.97C6.41031 7.97 9.03031 4.75 12.0003 4.75Z" fill="#EA4335"></path>
                <path d="M23.4903 12.27C23.4903 11.49 23.4303 10.74 23.3203 10H12.2503V14.52H18.7203C18.4303 15.93 17.5803 17.15 16.4203 17.99L19.6603 20.44C21.5403 18.73 22.9503 16.31 23.4903 12.27Z" fill="#4285F4"></path>
                <path d="M5.61031 14.97C5.35031 14.21 5.21031 13.44 5.21031 12.67C5.21031 11.9 5.35031 11.13 5.61031 10.37L2.37031 7.92C1.41031 9.92 0.870312 12.2 0.870312 14.67C0.870312 17.14 1.41031 19.42 2.37031 21.42L5.61031 18.97C5.35031 18.21 5.21031 17.44 5.21031 16.67C5.21031 15.9 5.35031 15.13 5.61031 14.37L5.61031 14.97Z" fill="#FBBC04"></path>
                <path d="M12.0003 23.75C15.0203 23.75 17.6903 22.72 19.6603 20.44L16.4203 17.99C15.5303 18.61 14.3503 19.06 12.0003 19.06C9.03031 19.06 6.41031 15.84 5.61031 13.84L2.37031 16.29C4.10031 20.06 7.79031 22.56 12.0003 22.56L12.0003 23.75Z" fill="#34A853"></path>
            </svg>
            <span>Sign In with Google</span>
        </button>
    </div>
</div>

<div id="main-content" class="hidden">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-center text-4xl font-extrabold text-blue-800">üìò Biology Units and Sub Units</h2>
        <div class="flex items-center space-x-4">
            <span id="user-id-display" class="text-gray-600 text-sm"></span>
            <button id="logout-btn" class="bg-gray-300 text-gray-800 p-2 rounded-lg font-semibold hover:bg-gray-400 transition-colors duration-200">Logout</button>
        </div>
    </div>

    <!-- Unit 01: Introduction to Biology -->
    <div class="unit bg-white rounded-xl shadow-md mb-4 p-4 cursor-pointer hover:bg-blue-50 transition-all duration-300 ease-in-out" onclick="openSubtopicsModal(this)">
      <div class="unit-title flex justify-between items-center text-2xl font-semibold text-blue-700 border-b border-dotted border-gray-300 pb-2 mb-2">
        <span class="flex-grow min-w-0">01. ‡∂¢‡∑ì‡∑Ä ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä ‡∑Ñ‡∂≥‡∑î‡∂±‡∑ä‡∑Ä‡∑è ‡∂Ø‡∑ì‡∂∏</span>
        <span class="text-green-600 text-lg w-12 text-right flex-shrink-0">(2)</span>
      </div>
      <ul class="subtopics">
        <li>‡∂∏‡∑í‡∂±‡∑í‡∑É‡∑è ‡∂∏‡∑î‡∑Ñ‡∑î‡∂´ ‡∂Ø‡∑ô‡∂± ‡∂Ö‡∂∑‡∑í‡∂∫‡∑ù‡∂ú ‡∑Ñ‡∑è ‡∂¢‡∑ì‡∑Ä ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä‡∑ö ‡∑É‡∑ä‡∑Ä‡∂∑‡∑è‡∑Ä‡∂∫</li>
        <li>‡∂¢‡∑õ‡∑Ä ‡∂Ω‡∑ù‡∂ö‡∂∫‡∑ö ‡∑É‡∑ä‡∑Ä‡∂∑‡∑è‡∑Ä‡∂∫ ‡∑Ñ‡∑è ‡∑É‡∂Ç‡∑Ä‡∑í‡∂∞‡∑è‡∂± ‡∂ª‡∂ß‡∑è</li>
      </ul>
    </div>

    <!-- Unit 02: Chemical and Cellular Basis of Life -->
    <div class="unit bg-white rounded-xl shadow-md mb-4 p-4 cursor-pointer hover:bg-blue-50 transition-all duration-300 ease-in-out" onclick="openSubtopicsModal(this)">
      <div class="unit-title flex justify-between items-center text-2xl font-semibold text-blue-700 border-b border-dotted border-gray-300 pb-2 mb-2">
        <span class="flex-grow min-w-0">02. ‡∂¢‡∑ì‡∑Ä‡∂∫‡∑ö ‡∂ª‡∑É‡∑è‡∂∫‡∂±‡∑í‡∂ö ‡∑Ñ‡∑è ‡∑É‡∑õ‡∂Ω‡∑ì‡∂∫ ‡∂¥‡∂Ø‡∂±‡∂∏</span>
        <span class="text-green-600 text-lg w-12 text-right flex-shrink-0">(9)</span>
      </div>
      <ul class="subtopics">
        <li>‡∂∏‡∑ñ‡∂Ω‡∂Ø‡∑ä‚Äç‡∂ª‡∑Ä‡∑ä‚Äç‡∂∫‡∂∏‡∂∫ ‡∑É‡∂Ç‡∂∫‡∑î‡∂≠‡∑í‡∂∫</li>
        <li>‡∂¢‡∂Ω‡∂∫‡∑ö ‡∂ú‡∑î‡∂´</li>
        <li>‡∂ö‡∑è‡∂∂‡∂±‡∑í‡∂ö ‡∑É‡∂Ç‡∂∫‡∑ù‡∂ú</li>
        <li>‡∑É‡∑õ‡∂Ω ‡∑Ä‡∑ä‚Äç‡∂∫‡∑ñ‡∑Ñ‡∂∫</li>
        <li>‡∑É‡∑õ‡∂Ω ‡∂†‡∂ö‡∑ä‚Äç‡∂ª‡∂∫</li>
        <li>‡∑Å‡∂ö‡∑ä‡∂≠‡∑í ‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞‡∂≠‡∑è</li>
        <li>‡∂ë‡∂±‡∑ä‡∑É‡∂∫‡∑í‡∂∏</li>
        <li>‡∂¥‡∑ä‚Äç‡∂ª‡∂∑‡∑è‡∑É‡∂Ç‡∑Å‡∑ä‡∂Ω‡∑ö‡∑Ç‡∂´‡∂∫</li>
        <li>‡∑É‡∑õ‡∂Ω‡∑ì‡∂∫ ‡∑Å‡∑ä‡∑Ä‡∑É‡∂±‡∂∫</li>
      </ul>
    </div>

    <!-- Unit 03: Evolution and Diversity of Organisms -->
    <div class="unit bg-white rounded-xl shadow-md mb-4 p-4 cursor-pointer hover:bg-blue-50 transition-all duration-300 ease-in-out" onclick="openSubtopicsModal(this)">
      <div class="unit-title flex justify-between items-center text-2xl font-semibold text-blue-700 border-b border-dotted border-gray-300 pb-2 mb-2">
        <span class="flex-grow min-w-0">03. ‡∂¥‡∂ª‡∑í‡∂´‡∑è‡∂∏‡∂∫ ‡∑Ñ‡∑è ‡∂¢‡∑ì‡∑Ä‡∑ì‡∂±‡∑ä‡∂ú‡∑ö ‡∑Ä‡∑í‡∑Ä‡∑í‡∂∞‡∂≠‡∑ä‡∑Ä‡∂∫</span>
        <span class="text-green-600 text-lg w-12 text-right flex-shrink-0">(8)</span>
      </div>
      <ul class="subtopics">
        <li>‡∂¥‡∂ª‡∑í‡∂´‡∑è‡∂∏ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∑Ä‡∂Ω‡∑í‡∂∫</li>
        <li>‡∂≠‡∂ö‡∑ä‡∑É‡∑ù‡∂± ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä</li>
        <li>‡∂∂‡∑ê‡∂ö‡∑ä‡∂ß‡∑ì‡∂ª‡∑í‡∂∫‡∑è</li>
        <li>‡∂¥‡∑ä‚Äç‡∂ª‡∑ù‡∂ß‡∑í‡∑É‡∑ä‡∂ß‡∑è</li>
        <li>‡∑Å‡∑è‡∂ö ‡∂ª‡∑è‡∂¢‡∂∞‡∑è‡∂±‡∑í‡∂∫</li>
        <li>‡∂Ø‡∑í‡∂Ω‡∑ì‡∂ª ‡∂ª‡∑è‡∂¢‡∂∞‡∑è‡∂±‡∑í‡∂∫</li>
        <li>‡∂á‡∂±‡∑í‡∂∏‡∑è‡∂Ω‡∑í‡∂∫‡∑è</li>
        <li>‡∂ö‡∑ù‡∂©‡∑ö‡∂ß‡∑è ‡∑Ä‡∂Ç‡∑Å‡∂∫</li>
      </ul>
    </div>

    <!-- Unit 04: Plant Form and Function -->
    <div class="unit bg-white rounded-xl shadow-md mb-4 p-4 cursor-pointer hover:bg-blue-50 transition-all duration-300 ease-in-out" onclick="openSubtopicsModal(this)">
      <div class="unit-title flex justify-between items-center text-2xl font-semibold text-blue-700 border-b border-dotted border-gray-300 pb-2 mb-2">
        <span class="flex-grow min-w-0">04. ‡∑Å‡∑è‡∂ö ‡∂Ü‡∂ö‡∑è‡∂ª‡∂∫ ‡∑Ñ‡∑è ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂ö‡∑è‡∂ª‡∑í‡∂≠‡∑ä‡∑Ä‡∂∫</span>
        <span class="text-green-600 text-lg w-12 text-right flex-shrink-0">(13)</span>
      </div>
      <ul class="subtopics">
        <li>‡∑Å‡∑è‡∂ö ‡∑Ä‡∂ª‡∑ä‡∂∞‡∂±‡∂∫ ‡∑Ñ‡∑è ‡∑Ä‡∑í‡∂ö‡∑É‡∂±‡∂∫</li>
        <li>‡∂¥‡∂ß‡∂ö ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í</li>
        <li>‡∂Ü‡∂Ω‡∑ù‡∂ö‡∂∫ ‡∂Ö‡∂∞‡∑í‡∂ú‡∑ä‚Äç‡∂ª‡∑Ñ‡∂´‡∂∫</li>
        <li>‡∑Ä‡∑è‡∂∫‡∑î ‡∑Ñ‡∑î‡∑Ä‡∂∏‡∑è‡∂ª‡∑î‡∑Ä</li>
        <li>‡∂¢‡∂Ω ‡∑Ñ‡∑è ‡∂õ‡∂±‡∑í‡∂¢ ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫‡∂≠‡∑è</li>
        <li>‡∂Ø‡∑ä‚Äç‡∂ª‡∑Ä‡∑ä‚Äç‡∂∫ ‡∂¥‡∂ª‡∑í‡∑Ä‡∑Ñ‡∂±‡∂∫</li>
        <li>‡∂¢‡∂Ω‡∂∫ ‡∂â‡∑Ä‡∂≠‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏</li>
        <li>‡∂¥‡∑ù‡∑Ç‡∂´ ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∑Ä‡∂Ω‡∑í</li>
        <li>‡∂¥‡∑ù‡∑Ç‡∂´ ‡∂Ö‡∑Ä‡∑Å‡∑ä‚Äç‡∂∫‡∂≠‡∑è</li>
        <li>‡∂¢‡∑ì‡∑Ä‡∂± ‡∂†‡∂ö‡∑ä‚Äç‡∂ª</li>
        <li>‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∂±‡∂±‡∂∫</li>
        <li>‡∂ã‡∂≠‡∑ä‡∂≠‡∑ö‡∂¢ ‡∑Ä‡∂Ω‡∂ß ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª</li>
        <li>‡∂Ü‡∂≠‡∂≠‡∑í ‡∑Ä‡∂Ω‡∂ß ‡∂¥‡∑ä‚Äç‡∂ª‡∂≠‡∑í‡∂†‡∑è‡∂ª</li>
      </ul>
    </div>

    <!-- Unit 05: Animal Form and Function -->
    <div class="unit bg-white rounded-xl shadow-md mb-4 p-4 cursor-pointer hover:bg-blue-50 transition-all duration-300 ease-in-out" onclick="openSubtopicsModal(this)">
      <div class="unit-title flex justify-between items-center text-2xl font-semibold text-blue-700 border-b border-dotted border-gray-300 pb-2 mb-2">
        <span class="flex-grow min-w-0">05. ‡∑É‡∂≠‡∑ä‡∂≠‡∑ä‡∑Ä ‡∂Ü‡∂ö‡∑è‡∂ª‡∂∫ ‡∑Ñ‡∑è ‡∂ö‡∑ä‚Äç‡∂ª‡∑í‡∂∫‡∑è‡∂ö‡∑è‡∂ª‡∑í‡∂≠‡∑ä‡∑Ä‡∂∫</span>
        <span class="text-green-600 text-lg w-12 text-right flex-shrink-0">(14)</span>
      </div>
      <ul class="subtopics">
        <li>‡∑É‡∂±‡∑ä‡∂∞‡∑è‡∂ª‡∂´‡∂∫</li>
        <li>‡∑É‡∑ä‡∂±‡∑è‡∂∫‡∑î ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫</li>
        <li>‡∑É‡∂Ç‡∑Ä‡∑ö‡∂Ø‡∂ö ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫</li>
        <li>‡∑É‡∂∏</li>
        <li>‡∂Ö‡∂±‡∑ä‡∂≠‡∂ª‡∑è‡∑É‡∂ª‡∑ä‡∂ú ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫</li>
        <li>‡∂Ö‡∂∑‡∑ä‚Äç‡∂∫‡∂±‡∑ä‡∂≠‡∂ª ‡∂¥‡∂ª‡∑í‡∑É‡∂ª‡∂∫</li>
        <li>‡∂¥‡∑î‡∂ª‡∑î‡∑Ç ‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∂±‡∂ö ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫</li>
        <li>‡∑É‡∑ä‡∂≠‡∑ä‚Äç‡∂ª‡∑ì ‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∂±‡∂ö ‡∂¥‡∂Ø‡∑ä‡∂∞‡∂≠‡∑í‡∂∫</li>
        <li>‡∂¥‡∑ä‚Äç‡∂ª‡∂¢‡∂±‡∂ö ‡∂†‡∂ö‡∑ä‚Äç‡∂ª‡∂∫</li>
        <li>‡∂ã‡∂¥‡∂≠‡∑ä ‡∂¥‡∑è‡∂Ω‡∂± ‡∂ö‡∑ä‚Äç‡∂ª‡∂∏</li>
        <li>‡∂∏‡∑è‡∂±‡∑Ä ‡∑É‡∑ê‡∂ö‡∑í‡∂Ω‡∑ä‡∂Ω</li>
        <li>‡∂ú‡∑è‡∂≠‡∑ä‚Äç‡∂ª‡∑è ‡∑É‡∑ê‡∂ö‡∑í‡∂Ω‡∑ä‡∂Ω</li>
        <li>‡∂ö‡∂Ç‡∂ö‡∑è‡∂Ω ‡∂¥‡∑ö‡∑Å‡∑í</li>
        <li>‡∑É‡∂Ç‡∂ö‡∑ù‡∂†‡∂± ‡∂∫‡∂±‡∑ä‡∂≠‡∑ä‚Äç‡∂ª‡∂´‡∂∫</li>
      </ul>
    </div>

    <!-- Unit 06: Genetics -->
    <div class="unit bg-white rounded-xl shadow-md mb-4 p-4 cursor-pointer hover:bg-blue-50 transition-all duration-300 ease-in-out" onclick="openSubtopicsModal(this)">
      <div class="unit-title flex justify-between items-center text-2xl font-semibold text-blue-700 border-b border-dotted border-gray-300 pb-2 mb-2">
        <span class="flex-grow min-w-0">06. ‡∂¥‡∑ä‚Äç‡∂ª‡∑Ä‡∑ö‡∂´‡∑í‡∂∫</span>
        <span class="text-green-600 text-lg w-12 text-right flex-shrink-0">(9)</span>
      </div>
      <ul class="subtopics">
        <li>‡∂¥‡∑ä‚Äç‡∂ª‡∑Ä‡∑ö‡∂´‡∑í ‡∑Ä‡∑è‡∂ú‡∑ä‡∂∏‡∑è‡∂Ω‡∑Ä</li>
        <li>‡∂∏‡∑î‡∑Ñ‡∑î‡∂∏</li>
        <li>‡∂∏‡∑ô‡∂±‡∑ä‡∂©‡∂Ω‡∑ä‡∂ú‡∑ö ‡∂¥‡∂ª‡∑ì‡∂ö‡∑ä‡∑Ç‡∂´</li>
        <li>‡∑É‡∂∏‡∑ä‡∂∑‡∑è‡∑Ä‡∑í‡∂≠‡∑è ‡∂±‡∑í‡∂∫‡∂∏</li>
        <li>‡∂∏‡∑è‡∂±‡∑Ä ‡∂Ω‡∂ö‡∑ä‡∑Ç‡∂´</li>
        <li>‡∂±‡∑ú‡∑Ä‡∂± ‡∂Ü‡∑Ä‡∑ö‡∂´‡∑í‡∂∫</li>
        <li>‡∂∂‡∑Ñ‡∑î ‡∂á‡∂Ω‡∑ì‡∂Ω‡∂≠‡∑è‡∑Ä</li>
        <li>‡∂ú‡∑Ñ‡∂± ‡∂¥‡∑ä‚Äç‡∂ª‡∑Ä‡∑ö‡∂´‡∑í‡∂∫</li>
        <li>‡∂Ö‡∂∑‡∑í‡∂¢‡∂±‡∂±‡∂∫</li>
      </ul>
    </div>

    <!-- Unit 09: Microbiology -->
    <div class="unit bg-white rounded-xl shadow-md mb-4 p-4 cursor-pointer hover:bg-blue-50 transition-all duration-300 ease-in-out" onclick="openSubtopicsModal(this)">
      <div class="unit-title flex justify-between items-center text-2xl font-semibold text-blue-700 border-b border-dotted border-gray-300 pb-2 mb-2">
        <span class="flex-grow min-w-0">09. ‡∂ö‡∑ä‡∑Ç‡∑î‡∂Ø‡∑ä‚Äç‡∂ª ‡∂¢‡∑ì‡∑Ä ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä</span>
        <span class="text-green-600 text-lg w-12 text-right flex-shrink-0">(7)</span>
      </div>
      <ul class="subtopics">
        <li>‡∂ö‡∑ä‡∑Ç‡∑î‡∂Ø‡∑ä‚Äç‡∂ª ‡∂¢‡∑ì‡∑Ä‡∑ì‡∂±‡∑ä‡∂ú‡∑ö ‡∑É‡∑ä‡∑Ä‡∂∑‡∑è‡∑Ä‡∂∫</li>
        <li>‡∂ö‡∑ä‡∑Ç‡∑î‡∂Ø‡∑ä‚Äç‡∂ª ‡∂¢‡∑ì‡∑Ä‡∑ì‡∂±‡∑ä‡∂ú‡∑ö ‡∂Ü‡∂ö‡∑è‡∂ª</li>
        <li>‡∂≠‡∑è‡∂ö‡∑ä‡∑Ç‡∂´‡∑í‡∂ö ‡∑Å‡∑í‡∂Ω‡∑ä‡∂¥</li>
        <li>‡∂ö‡∂ª‡∑ä‡∂∏‡∑è‡∂±‡∑ä‡∂≠ ‡∑É‡∑Ñ ‡∂¥‡∂ª‡∑í‡∑É‡∂ª‡∂∫</li>
        <li>‡∂¥‡∑è‡∂Ç‡∑Å‡∑î ‡∂ö‡∑ä‡∑Ç‡∑î‡∂Ø‡∑ä‚Äç‡∂ª‡∂¢‡∑ì‡∑Ä‡∑ì‡∂±‡∑ä</li>
        <li>‡∂Ö‡∂¥‡∂¢‡∂Ω ‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∂´‡∂∫</li>
        <li>‡∂Ü‡∑Ñ‡∑è‡∂ª ‡∑Ñ‡∑è ‡∂ö‡∑ä‡∑Ç‡∑î‡∂Ø‡∑ä‚Äç‡∂ª‡∂¢‡∑ì‡∑Ä‡∑ì‡∂±‡∑ä</li>
      </ul>
    </div>

    <!-- Unit 10: Applied Biology -->
    <div class="unit bg-white rounded-xl shadow-md mb-4 p-4 cursor-pointer hover:bg-blue-50 transition-all duration-300 ease-in-out" onclick="openSubtopicsModal(this)">
      <div class="unit-title flex justify-between items-center text-2xl font-semibold text-blue-700 border-b border-dotted border-gray-300 pb-2 mb-2">
        <span class="flex-grow min-w-0">10. ‡∑Ä‡∑ä‚Äç‡∂∫‡∑Ä‡∑Ñ‡∑è‡∂ª‡∑í‡∂ö ‡∂¢‡∑ì‡∑Ä ‡∑Ä‡∑í‡∂Ø‡∑ä‚Äç‡∂∫‡∑è‡∑Ä</span>
        <span class="text-green-600 text-lg w-12 text-right flex-shrink-0">(8)</span>
      </div>
      <ul class="subtopics">
        <li>‡∂¢‡∂Ω‡∂¢‡∑ì‡∑Ä‡∑ì ‡∑Ä‡∂ú‡∑è‡∑Ä</li>
        <li>‡∂∏‡∂≠‡∑ä‡∑É‡∑ä‚Äç‡∂∫ ‡∑Ä‡∂ú‡∑è‡∑Ä</li>
        <li>‡∂∏‡∑í‡∂ª‡∑í‡∂Ø‡∑í‡∂∫ ‡∂ª‡∑ù‡∂ú</li>
        <li>‡∂≠‡∑Ä‡∑è‡∂±‡∑ä ‡∂ö‡∑Ö‡∂∏‡∂±‡∑è‡∂ö‡∂ª‡∂´‡∂∫</li>
        <li>‡∂Ü‡∑Ñ‡∑è‡∂ª ‡∂¥‡∂ª‡∑í‡∂ª‡∂ö‡∑ä‡∑Ç‡∂´‡∂∫</li>
        <li>‡∂Ö‡∑É‡∑ä‡∑Ä‡∂±‡∑î ‡∑Ñ‡∑è‡∂±‡∑í‡∂∫</li>
        <li>‡∂©‡∑ô‡∂Ç‡∂ú‡∑î ‡∑É‡∑Ñ ‡∂∂‡∂ª‡∑Ä‡∑è</li>
        <li>‡∂±‡∑ê‡∂±‡∑ù ‡∂≠‡∑è‡∂ö‡∑ä‡∑Ç‡∂´‡∂∫</li>
      </ul>
    </div>

    <!-- Summary Section -->
    <div class="summary mt-10 bg-green-50 border-l-8 border-green-500 p-6 text-xl rounded-lg text-green-800">
      üî¢ <strong class="font-bold">Total Units:</strong> 8<br>
      üü© <strong class="font-bold">Total Subtopics:</strong> 70
    </div>
</div>

<!-- Subtopic Modal Structure -->
<div id="subtopicModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 hidden">
  <div class="bg-gray-50 rounded-2xl shadow-2xl p-8 w-11/12 md:w-2/3 lg:w-1/2 relative border border-gray-200 ring-4 ring-blue-200 ring-opacity-50">
    <button id="closeModal" class="absolute top-4 right-4 text-gray-700 hover:text-gray-900 bg-gray-100 hover:bg-gray-200 rounded-full p-2 transition-colors duration-200 ease-in-out text-4xl font-bold">&times;</button>
    <h3 id="modalTitle" class="text-3xl font-bold text-blue-800 mb-4"></h3>
    <ul id="modalSubtopics" class="list-none text-gray-700 space-y-3 leading-relaxed">
      <!-- Subtopics will be dynamically added here -->
    </ul>
    <!-- Reminder Message Display - MOVED INSIDE MODAL CONTENT -->
    <div id="reminderMessage"></div>
  </div>
</div>

<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  // Your web app's Firebase configuration (provided by the user)
  const firebaseConfig = {
    apiKey: "AIzaSyApLfVQ6hv0IAAN5ZkFlOQ-y5KXK-x1Q_M",
    authDomain: "reminderapp-d84e9.firebaseapp.com",
    databaseURL: "https://reminderapp-d84e9-default-rtdb.firebaseio.com",
    projectId: "reminderapp-d84e9",
    storageBucket: "reminderapp-d84e9.firebasestorage.app",
    messagingSenderId: "312145339940",
    appId: "1:312145339940:web:ade59de4d6de6cec221ab1"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  // Global variables
  let userId = null;
  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
  // Updated structure for completedSubtopicsState
  let completedSubtopicsState = {}; // Stores { "Unit Title": { total: N, subtopics: { "Subtopic Text": true/false, ... } } }
  let unsubscribeSnapshot = null; // To store the unsubscribe function for Firestore listener
  let isAuthReady = false; // New flag to indicate if auth and initial data load are complete

  // UI Elements
  const authSection = document.getElementById('auth-section');
  const mainContent = document.getElementById('main-content');
  const authErrorDiv = document.getElementById('auth-error');
  const emailInput = document.getElementById('email-input');
  const passwordInput = document.getElementById('password-input');
  const signInEmailBtn = document.getElementById('signin-email-btn');
  const signUpEmailBtn = document.getElementById('signup-email-btn');
  const signInGoogleBtn = document.getElementById('signin-google-btn');
  const logoutBtn = document.getElementById('logout-btn');
  const userIdDisplay = document.getElementById('user-id-display');

  // Function to display authentication errors
  function showAuthError(message) {
    authErrorDiv.textContent = message;
    authErrorDiv.classList.remove('hidden');
  }

  // Function to hide authentication errors
  function hideAuthError() {
    authErrorDiv.classList.add('hidden');
    authErrorDiv.textContent = '';
  }

  // Handle Google Sign-In
  signInGoogleBtn.addEventListener('click', async () => {
    hideAuthError();
    try {
      await signInWithPopup(auth, new GoogleAuthProvider());
    } catch (error) {
      console.error("Google Sign-In Error:", error);
      showAuthError(error.message);
    }
  });

  // Handle Email/Password Sign-Up
  signUpEmailBtn.addEventListener('click', async () => {
    hideAuthError();
    const email = emailInput.value;
    const password = passwordInput.value;
    if (!email || !password) {
      showAuthError("Please enter both email and password.");
      return;
    }
    try {
      await createUserWithEmailAndPassword(auth, email, password);
    } catch (error) {
      console.error("Email Sign-Up Error:", error);
      showAuthError(error.message);
    }
  });

  // Handle Email/Password Sign-In
  signInEmailBtn.addEventListener('click', async () => {
    hideAuthError();
    const email = emailInput.value;
    const password = passwordInput.value;
    if (!email || !password) {
      showAuthError("Please enter both email and password.");
      return;
    }
    try {
      await signInWithEmailAndPassword(auth, email, password);
    } catch (error) {
      console.error("Email Sign-In Error:", error);
      showAuthError(error.message);
    }
  });

  // Handle Logout
  logoutBtn.addEventListener('click', async () => {
    try {
      await signOut(auth);
    } catch (error) {
      console.error("Logout Error:", error);
      showAuthError("Failed to log out."); // Display error if logout fails
    }
  });

  // Function to initialize unit completion displays
  function initializeUnitDisplays() {
    document.querySelectorAll('.unit').forEach(unitElement => {
      const unitTitleText = unitElement.querySelector('.unit-title span:first-child').textContent;
      const subtopicsList = unitElement.querySelector('.subtopics');
      const totalSubtopicsSpan = unitElement.querySelector('.unit-title span:last-child');
      const initialTotalSubtopics = parseInt(totalSubtopicsSpan.textContent.replace(/[()]/g, ''));

      // Ensure the unit's entry exists in completedSubtopicsState with its total
      if (!completedSubtopicsState[unitTitleText]) {
        completedSubtopicsState[unitTitleText] = {
          total: initialTotalSubtopics,
          subtopics: {}
        };
      } else if (typeof completedSubtopicsState[unitTitleText].total === 'undefined') {
        // If total was not set in loaded data, set it from initial HTML
        completedSubtopicsState[unitTitleText].total = initialTotalSubtopics;
      }

      // Initialize subtopics within the state if they don't exist
      Array.from(subtopicsList.children).forEach(subtopic => {
        const subtopicText = subtopic.textContent;
        if (typeof completedSubtopicsState[unitTitleText].subtopics[subtopicText] === 'undefined') {
          completedSubtopicsState[unitTitleText].subtopics[subtopicText] = false;
        }
      });
      // Update display to reflect current state or (0/Total)
      updateUnitCompletionDisplay(unitElement);
    });
  }

  // Function to update the count on the main unit button
  function updateUnitCompletionDisplay(unitElement) {
    const unitTitleText = unitElement.querySelector('.unit-title span:first-child').textContent;
    const totalSubtopicsSpan = unitElement.querySelector('.unit-title span:last-child');

    let completedCount = 0;
    const unitData = completedSubtopicsState[unitTitleText];

    if (unitData && unitData.subtopics) {
      for (const subtopicText in unitData.subtopics) {
        if (unitData.subtopics[subtopicText]) {
          completedCount++;
        }
      }
      // Use the stored total from completedSubtopicsState
      totalSubtopicsSpan.textContent = `(${completedCount}/${unitData.total})`;
    } else {
      // Fallback if data is not yet initialized for some reason
      // This should ideally not be reached if initializeUnitDisplays runs correctly
      totalSubtopicsSpan.textContent = `(0/${parseInt(totalSubtopicsSpan.textContent.replace(/[()]/g, '')) || 0})`;
    }
  }

  // Function to open the subtopics modal
  function openSubtopicsModal(unitElement) {
    // Prevent modal from opening if authentication and data loading are not ready
    if (!isAuthReady) {
      showAuthError("Please wait, loading your data or sign in to track your progress.");
      return;
    }
    hideAuthError(); // Hide any previous auth errors

    const unitTitleText = unitElement.querySelector('.unit-title span:first-child').textContent;
    const subtopicsList = unitElement.querySelector('.subtopics');
    const modalTitle = document.getElementById('modalTitle');
    const modalSubtopics = document.getElementById('modalSubtopics');
    const subtopicModal = document.getElementById('subtopicModal');
    const reminderMessageDiv = document.getElementById('reminderMessage');

    // Set modal title
    modalTitle.textContent = unitTitleText;

    // Clear previous subtopics
    modalSubtopics.innerHTML = '';

    const unitData = completedSubtopicsState[unitTitleText];

    // Populate modal with subtopics and add tick circles
    Array.from(subtopicsList.children).forEach(subtopic => {
      const li = document.createElement('li');
      li.classList.add('flex', 'items-center', 'gap-3');

      const tickCircle = document.createElement('span');
      tickCircle.classList.add('tick-circle');

      const subtopicTextContent = subtopic.textContent;

      // Set initial state of tick circle from global state
      if (unitData && unitData.subtopics && unitData.subtopics[subtopicTextContent]) {
        tickCircle.classList.add('checked');
        tickCircle.innerHTML = '&#10003;';
      } else {
        tickCircle.innerHTML = '';
      }

      // Add click event listener to toggle checked state
      tickCircle.addEventListener('click', async () => {
        tickCircle.classList.toggle('checked');
        const isChecked = tickCircle.classList.contains('checked');
        tickCircle.innerHTML = isChecked ? '&#10003;' : '';

        // Update global state
        if (!completedSubtopicsState[unitTitleText]) {
            // This case should ideally not be hit if initializeUnitDisplays runs correctly
            completedSubtopicsState[unitTitleText] = { total: 0, subtopics: {} };
        }
        if (!completedSubtopicsState[unitTitleText].subtopics) {
            completedSubtopicsState[unitTitleText].subtopics = {};
        }
        completedSubtopicsState[unitTitleText].subtopics[subtopicTextContent] = isChecked;

        // Update the count on the main unit button
        updateUnitCompletionDisplay(unitElement);

        // Save to Firestore
        if (userId) {
          try {
            const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/userData/completedSubtopics`);
            // Save the entire completedSubtopicsState object
            await setDoc(userDocRef, { data: JSON.stringify(completedSubtopicsState) }, { merge: true });
            console.log("Subtopic state saved to Firestore.");
          } catch (e) {
            console.error("Error saving document: ", e);
            showAuthError("Error saving progress. Please try again.");
          }
        }

        // Show reminder message if ticked
        if (isChecked) {
          showReminderMessage(`[${subtopicTextContent}] ‡∑É‡∂≥‡∑Ñ‡∑è ‡∂∏‡∂≠‡∂ö‡∑ä ‡∂ö‡∑í‡∂ª‡∑ì‡∂∏‡∂ö‡∑ä ‡∂ë‡∂ö‡∑ä ‡∂ö‡∂ª‡∂±‡∑ä‡∂±`);
        } else {
          // If unticked, hide the reminder message if it's currently showing for this subtopic
          if (reminderMessageDiv.textContent.includes(subtopicTextContent)) {
            hideReminderMessage();
          }
        }
      });

      const subtopicDisplay = document.createElement('span');
      subtopicDisplay.textContent = subtopicTextContent;
      subtopicDisplay.classList.add('flex-grow');

      li.appendChild(tickCircle);
      li.appendChild(subtopicDisplay);
      modalSubtopics.appendChild(li);
    });

    // Show the modal overlay
    subtopicModal.classList.remove('hidden');

    // Force a reflow to ensure the 'display' change is rendered before applying 'is-active'
    subtopicModal.offsetWidth;

    // Add 'is-active' class to trigger the pop-in animation
    subtopicModal.classList.add('is-active');
    subtopicModal.classList.remove('is-closing'); // Ensure closing animation class is removed
  }

  // Get modal elements (these are global for the modal)
  const subtopicModal = document.getElementById('subtopicModal');
  const closeModalButton = document.getElementById('closeModal');
  const reminderMessageDiv = document.getElementById('reminderMessage');

  // Add event listener to the reminder message div to open the URL
  reminderMessageDiv.addEventListener('click', () => {
    window.open('https://alstudy063.github.io/my-reminder-app/Unsaved%20Document%202.html', '_blank');
  });

  // Function to hide the reminder message
  function hideReminderMessage() {
    reminderMessageDiv.classList.remove('show');
  }

  // Function to close the modal with animation
  function closeSubtopicModal() {
    // Add 'is-closing' class to trigger the pop-out animation
    subtopicModal.classList.add('is-closing');
    subtopicModal.classList.remove('is-active'); // Remove active class for overlay fade

    hideReminderMessage(); // Hide reminder when modal closes

    // Hide the modal completely after the animation ends
    subtopicModal.querySelector('div').addEventListener('animationend', function handler() {
      subtopicModal.classList.add('hidden');
      subtopicModal.classList.remove('is-closing'); // Clean up the closing class
      this.removeEventListener('animationend', handler); // Remove listener
    }, { once: true }); // Ensure the listener is called only once
  }

  // Close modal when close button is clicked
  closeModalButton.addEventListener('click', closeSubtopicModal);

  // Close modal when clicking outside the modal content
  subtopicModal.addEventListener('click', (event) => {
    if (event.target === subtopicModal) {
      closeSubtopicModal();
    }
  });

  // Firebase Auth State Listener
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      // User is signed in
      userId = user.uid;
      userIdDisplay.textContent = `User ID: ${userId}`;
      authSection.classList.add('hidden');
      mainContent.classList.remove('hidden');
      hideAuthError(); // Hide any auth errors once logged in

      // Unsubscribe from previous snapshot listener if it exists
      if (unsubscribeSnapshot) {
        unsubscribeSnapshot();
      }

      // Listen for real-time updates to user's data
      const userDocRef = doc(db, `artifacts/${appId}/users/${userId}/userData/completedSubtopics`);
      unsubscribeSnapshot = onSnapshot(userDocRef, (docSnap) => {
        // Create a temporary state based on initial HTML structure
        const tempCompletedSubtopicsState = {};
        document.querySelectorAll('.unit').forEach(unitElement => {
            const unitTitleText = unitElement.querySelector('.unit-title span:first-child').textContent;
            const initialTotalSubtopics = parseInt(unitElement.querySelector('.unit-title span:last-child').textContent.replace(/[()]/g, ''));
            const subtopicsList = unitElement.querySelector('.subtopics');

            tempCompletedSubtopicsState[unitTitleText] = {
                total: initialTotalSubtopics,
                subtopics: {}
            };
            Array.from(subtopicsList.children).forEach(subtopic => {
                tempCompletedSubtopicsState[unitTitleText].subtopics[subtopic.textContent] = false;
            });
        });

        if (docSnap.exists() && docSnap.data().data) {
          try {
            const loadedData = JSON.parse(docSnap.data().data);
            // Merge loaded data into the temporary state
            for (const unitTitle in tempCompletedSubtopicsState) {
                if (loadedData[unitTitle] && loadedData[unitTitle].subtopics) {
                    // Merge subtopic completion status from loaded data
                    for (const subtopicText in tempCompletedSubtopicsState[unitTitle].subtopics) {
                        if (typeof loadedData[unitTitle].subtopics[subtopicText] !== 'undefined') {
                            tempCompletedSubtopicsState[unitTitle].subtopics[subtopicText] = loadedData[unitTitle].subtopics[subtopicText];
                        }
                    }
                }
            }
            completedSubtopicsState = tempCompletedSubtopicsState; // Assign the merged state
            console.log("Loaded and merged completed subtopics:", completedSubtopicsState);
          } catch (e) {
            console.error("Error parsing Firestore data:", e);
            completedSubtopicsState = tempCompletedSubtopicsState; // Fallback to initial HTML structure
          }
        } else {
          console.log("No completed subtopics found for this user, initializing empty state from HTML.");
          completedSubtopicsState = tempCompletedSubtopicsState; // Use initial HTML structure
        }
        initializeUnitDisplays(); // Update UI with loaded or re-initialized data
        isAuthReady = true; // Set flag to true after data is loaded and UI updated
      }, (error) => {
        console.error("Error listening to Firestore:", error);
        showAuthError("Error loading user data.");
        isAuthReady = true; // Still set to true, even on error, to allow interaction (though data might be missing)
      });

    } else {
      // User is signed out
      userId = null;
      userIdDisplay.textContent = '';
      authSection.classList.remove('hidden');
      mainContent.classList.add('hidden');
      completedSubtopicsState = {}; // Clear state on logout
      initializeUnitDisplays(); // Reset UI counts to 0
      isAuthReady = false; // Reset flag when logged out

      // Unsubscribe from snapshot listener when user logs out
      if (unsubscribeSnapshot) {
        unsubscribeSnapshot();
        unsubscribeSnapshot = null;
      }
    }
  });

  // Initial anonymous sign-in or custom token sign-in
  document.addEventListener('DOMContentLoaded', async () => {
    try {
      if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
        await signInWithCustomToken(auth, __initial_auth_token);
        console.log("Signed in with custom token.");
      } else {
        await signInAnonymously(auth);
        console.log("Signed in anonymously.");
      }
    } catch (error) {
      // Handle the specific custom-token-mismatch error more gracefully
      if (error.code === 'auth/custom-token-mismatch') {
        console.warn("Initial authentication with custom token failed (token mismatch). Please sign in manually.");
      } else {
        console.error("Initial authentication error:", error);
      }
      isAuthReady = true; // Allow interaction even if initial auth fails, user can sign in manually
    }
  });
</script>

</body>
</html>
